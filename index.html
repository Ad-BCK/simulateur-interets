<!DOCTYPE html> <html lang="fr"> <head> <meta charset="UTF-8"> <title>Simulateur d'Intérêts Composés</title> <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <style> body { font-family: Arial, sans-serif; margin: 40px; } label, input, textarea { display: block; margin: 10px 0; } canvas { max-width: 700px; margin-top: 30px; } table { border-collapse: collapse; margin-top: 30px; } th, td { border: 1px solid #ccc; padding: 8px; text-align: right; } th { background-color: #f4f4f4; } #exportBtn { margin-top: 20px; } </style> </head> <body> <h1>Simulateur d'Intérêts Composés avec Frais</h1>

<label>Versement initial (€): <input type="number" id="initial" value="10000"></label> <label>Frais sur versement (%): <input type="number" id="fraisVersement" value="1"></label> <label>Frais de gestion annuels (%): <input type="number" id="fraisGestion" value="1.5"></label> <label>Frais d'entrée (%): <input type="number" id="fraisEntree" value="2"></label> <label>Taux d'intérêt annuel (%): <input type="number" id="tauxInteret" value="5"></label> <label>Taux de rentabilité annuel comparatif (%): <input type="number" id="tauxIndice" value="7"></label> <label>Durée (années): <input type="number" id="duree" value="20"></label> <label>Versement mensuel (€): <input type="number" id="mensuel" value="100"></label> <label>Versements ponctuels (format: annee,montant; ex: 5,2000|10,1500): <input type="text" id="ponctuels" value=""></label> <label>Retraits ponctuels (format: annee,montant; ex: 8,1000|15,3000): <input type="text" id="retraits" value=""></label> <label>Fiscalité sur plus-value (%): <input type="number" id="fiscalite" value="30"></label>

<button onclick="simuler()">Lancer la simulation</button> <button id="exportBtn" onclick="exporterCSV()">Exporter en CSV</button>

<canvas id="graphique"></canvas> <table id="resultats"></table>

<script> function parsePonctuels(input) { const map = {}; input.split('|').forEach(pair => { const [annee, montant] = pair.split(',').map(x => parseFloat(x)); if (!isNaN(annee) && !isNaN(montant)) map[annee] = montant; }); return map; }

function simuler() {
  const initial = parseFloat(document.getElementById('initial').value);
  const fraisVersement = parseFloat(document.getElementById('fraisVersement').value) / 100;
  const fraisGestion = parseFloat(document.getElementById('fraisGestion').value) / 100;
  const fraisEntree = parseFloat(document.getElementById('fraisEntree').value) / 100;
  const tauxInteret = parseFloat(document.getElementById('tauxInteret').value) / 100;
  const tauxIndice = parseFloat(document.getElementById('tauxIndice').value) / 100;
  const duree = parseInt(document.getElementById('duree').value);
  const mensuel = parseFloat(document.getElementById('mensuel').value);
  const ponctuels = parsePonctuels(document.getElementById('ponctuels').value);
  const retraits = parsePonctuels(document.getElementById('retraits').value);
  const fiscalite = parseFloat(document.getElementById('fiscalite').value) / 100;

  let capital = initial * (1 - fraisVersement - fraisEntree);
  const labels = [];
  const data = [];
  const sansFraisData = [];
  const indiceData = [];
  const versementsMensuels = [];
  let tableauHTML = '<tr><th>Année</th><th>Capital net (€)</th><th>Sans frais (€)</th><th>Indice (€)</th><th>Fiscalité appliquée (€)</th></tr>';
  let csvContent = 'Année,Capital net (€),Sans frais (€),Indice (€),Fiscalité appliquée (€)

';

  let capitalSansFrais = initial;
  let capitalIndice = initial;

  for (let annee = 1; annee <= duree; annee++) {
    let versementAnnuel = 0;
    for (let mois = 1; mois <= 12; mois++) {
      capital += mensuel * (1 - fraisVersement);
      versementAnnuel += mensuel;
      capital *= (1 + tauxInteret / 12);
      capital *= (1 - fraisGestion / 12);

      capitalSansFrais += mensuel;
      capitalSansFrais *= (1 + tauxInteret / 12);

      capitalIndice *= (1 + tauxIndice / 12);
    }

    if (ponctuels[annee]) capital += ponctuels[annee] * (1 - fraisVersement);
    if (retraits[annee]) capital -= retraits[annee];

    const plusValue = capital - initial;
    const fiscaliteAppliquee = plusValue > 0 ? plusValue * fiscalite : 0;
    const capitalApresFiscalite = capital - fiscaliteAppliquee;

    labels.push(annee);
    data.push(capitalApresFiscalite.toFixed(2));
    sansFraisData.push(capitalSansFrais.toFixed(2));
    indiceData.push(capitalIndice.toFixed(2));
    versementsMensuels.push(versementAnnuel);

    tableauHTML += `<tr><td>${annee}</td><td>${capitalApresFiscalite.toFixed(2)}</td><td>${capitalSansFrais.toFixed(2)}</td><td>${capitalIndice.toFixed(2)}</td><td>${fiscaliteAppliquee.toFixed(2)}</td></tr>`;
    csvContent += `${annee},${capitalApresFiscalite.toFixed(2)},${capitalSansFrais.toFixed(2)},${capitalIndice.toFixed(2)},${fiscaliteAppliquee.toFixed(2)}

`; }

  document.getElementById('resultats').innerHTML = tableauHTML;

  if (window.monGraphique) {
    window.monGraphique.destroy();
  }
  window.monGraphique = new Chart(document.getElementById('graphique'), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        { label: 'Versements mensuels (€)', data: versementsMensuels, backgroundColor: 'rgba(128,128,128,0.4)', yAxisID: 'y' },
        { label: 'Capital net (€)', data: data, type: 'line', borderColor: 'blue', fill: false, yAxisID: 'y' },
        { label: 'Sans frais (€)', data: sansFraisData, type: 'line', borderColor: 'green', fill: false, yAxisID: 'y' },
        { label: 'Indice comparatif (€)', data: indiceData, type: 'line', borderColor: 'orange', fill: false, yAxisID: 'y' }
      ]
    },
    options: {
      responsive: true,
      aspectRatio: 2,
      scales: {
        y: {
          beginAtZero: false,
          position: 'left'
        }
      }
    }
  });

  window.csvContent = csvContent;
}

function exporterCSV() {
  const blob = new Blob([window.csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.setAttribute('href', URL.createObjectURL(blob));
  link.setAttribute('download', 'simulation_interets_composes.csv');
  link.style.display = 'none';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

</script> </body> </html>' }); const link = document.createElement('a'); link.setAttribute('href', URL.createObjectURL(blob)); link.setAttribute('download', 'simulation_interets_composes.csv'); link.style.display = 'none'; document.body.appendChild(link); link.click(); document.body.removeChild(link); } </script> </body> </html>
